# Sionnaシミュレーション 実装ガイドライン

このドキュメントは、Sionnaを使用したシミュレーション基盤を実装・拡張する際の指針を示します。Antigravity（AIアシスタント）および開発者が参照することを想定しています。

## 1. 基本方針

### 1.1 Sionna構造の尊重
- **独自概念の乱立を避ける:** `CarrierConfig` のような独自の命名は極力避け、Sionnaのクラス名（`StreamManagement`, `ResourceGrid` など）に合わせた命名を行ってください。
- **ミラーリング:** 設定クラス（`dataclass`）を作成する際は、Sionnaの対応するクラスの `__init__` 引数とフィールド名を一致させてください。これにより、`asdict` を使ったkwargs展開が可能になり、可読性と保守性が向上します。

### 1.2 設定とロジックの分離
- **Config First:** シミュレーションの全パラメータは `libs/my_configs.py` 内のデータクラスとして定義し、ロジック（`libs/sim_core.py`）内にハードコードしないでください。
- **再現性:** 実行時に使用した Config オブジェクトは、必ず再利用可能な形（`repr()`の出力など）でログ保存してください。

## 2. ディレクトリ構成の意図

```text
project_root/
├── libs/
│   ├── my_configs.py  # Sionnaのクラス定義を参照用としてミラーリングしたデータクラス群
│   └── sim_core.py    # Configを受け取り、Sionnaを駆動するエンジン
├── experiments/       # 実験ごとのスクリプト（sweeps, single_runs）
└── results/           # 生成物はここへ（.gitignore推奨）
```

## 3. IDEサポートへの配慮

- **型ヒント:** 全ての関数、メソッド、データクラスフィールドに型ヒントを付与してください。
- **Docstring:** 主要なクラスや複雑な関数には、引数と戻り値の説明を記述してください。
- **空のデータクラス:** 実際に値を持たせない場合でも、IDEのジャンプ機能や補完を効かせるために、Sionnaのクラスに対応するデータクラス定義を `my_configs.py` に残すことは推奨されます。

## 4. デバッグ・トラブルシューティング

- **Configスナップショット:** エラー発生時は `results/` 以下の `config_snapshot.py` を確認し、その設定で再現するかを確認してください。
- **モジュラーなテスト:** `sim_core.py` の各機能（シーン構築、パス計算など）は可能な限り疎結合に保ち、単体でテストできるようにしてください。
